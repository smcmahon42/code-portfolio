$(function(){function o(){var e=$("body").attr("time");if(e>1378598400){$("#footer, #landing").fadeOut(200,function(){$(this).remove();$("#logo").animate({right:"702px"},300)});$("#main").prepend('<div class="endGame"><p>Unfortunately the game has ended, but you can still grab a seat and learn more about our Elevate<sup>&#174;</sup> partners by visiting <a href="http://www.virginamerica.com/">virginamerica.com</a>.</p></div>')}}function u(){if(window.location.hash==="#entertowin"){setTimeout(function(){f("register")},1e3)}}function a(){$("#scroll_wrapper").mCustomScrollbar({scrollButtons:{enable:true},scrollInertia:600,autoDraggerLength:false})}function f(e){App.LoadPage.init(e,function(){if(e==="pick_partners"){l();a()}if(e==="game"){g()}if(e==="defeated"){c();L()}if(e==="success"){N()}if(e==="doubledown"){y()}if(e==="register"){M();N();k()}if(e==="confirm"){N("confirm");A();c();var t=new P;t.init()}})}function l(){function e(e,t){$("#partner_wrapper #scroll_wrapper").append('<div id="'+e+'" class="partner" data-title="'+t+'"><img src="/images/logos/'+e+'.jpg" /><div class="selectPartner"><span></span>SELECT<div></div></span></div></div>')}$.each(App.Partners.all,function(t,n){e(n[0],n[1])});$(".partner").bind("click",function(){var e=$(this).attr("id");if($(this).hasClass("checked")){$(this).removeClass("checked");$(this).children("div").children("span").css({backgroundPosition:0+"px"});$("li#p_"+e).fadeOut(300,function(){$(this).remove()})}else{$(this).addClass("checked");$(this).children("div").children("span").css({backgroundPosition:-22+"px"});$("#pickedWrapper").append('<li id="p_'+e+'" style="display:none;"><img src="/images/logos/'+e+'.jpg" /></li>');$("li#p_"+e).fadeIn(300)}})}function c(){function e(e,t,n){$("#partner_wrapper #logo_wrapper").append('<a href="'+n+'" target="_blank"><div class="partnerSorry" data-title="'+t+'"><img src="/images/logos/'+e+'.jpg" /></div></a>')}$.each(App.Partners.all,function(t,n){e(n[0],n[1],n[3])})}function h(){function r(e){var t=[];t=Number(App.Partners.picked[e]);return t}var e=App.Partners.picked;var t="";var n;$partnersCookie=$.cookie("partners");if($partnersCookie===undefined){o=[]}else{var i=0;var s=0;n=$partnersCookie.split(",");var o=[];while(i<e.length){var u=false;for(var a=0;a<n.length;a++){if(Number(e[i])===Number(n[a])){u=true;break}}if(u===false){o[s]=Number(e[i]);s++}i++}}if(o.length===0){if($partnersCookie!==undefined){t=Number(n[0])}else{t=e[0]}}else if(o.length===1){t=Number(o[0])}else{var f=Number(p(0,o.length-1));t=o[f]}App.AjaxCalls.apiPartner(t);App.Partners.singleId=t;for(key in App.Partners.all){if(Number(App.Partners.all[key][0])===Number(t)){App.Partners.singleTitle=App.Partners.all[key][1]}}if($partnersCookie===undefined){$.cookie("partners",t,{expires:30})}else{if(n.length<6){n.push(t)}else{n.shift();n.push(t)}$.cookie("partners",n,{expires:30})}}function p(e,t){return random=Math.floor(Math.random()*(t-e+1))+e}function d(){var e=[],t=[0,15,30,45,60,75,90],n="",r=0,s=1;for(i=0;i<6;i++){var o=[];var u=0;while(u<6){var a=p(t[i]+1,t[i+1]);var f=false;for(var l=0;l<o.length;l++){if(o[l]===a){f=true;break}}if(!f){o[u]=a;if(u==5){e[i]=o}u++}}}App.GameStat.boardNums=e;for(var l=0;l<6;l++){n+='<div class="game_row">';for(var c=0;c<6;c++){n+='<div id="cell'+s+'" class="game_cell open"><span>'+e[c][r]+"</span></div>";s++}n+="</div>";r++}$("#game_board").html(n)}function v(){var e=[];var t=[];var n=0;var r=App.GameInfo.cells;var i=p(0,5);var s=r[i];r.splice(i,1);var o=p(8,11);while(n<o){var u=p(1,36);var a=false;for(var f=0;f<r.length;f++){if(r[f]===u||s===u){a=true;break}}for(var l=0;l<e.length;l++){if(e[l]===u){a=true;break}}if(!a){e[n]=u;n++}}while(t.length<5){var u=p(1,o-1);var c=false;for(var f=0;f<t.length;f++){if(t[f]==u){c=true;break}}if(!c)t[t.length]=u}for(f=0;f<5;f++){e[t[f]]=r[f]}e.push(s);App.GameStat.winningSeq=e;m();return true}function m(e){var t=[];var n=[];var r=App.GameStat.winningSeq;var i=0;var s=0;while(i<36-r.length){var o=p(1,36);var u=false;for(var a=0;a<r.length;a++){if(r[a]===o){u=true;break}}for(var f=0;f<t.length;f++){if(t[f]===o){u=true;break}}if(!u){t[i]=o;i++}}App.GameStat.losingSeq=t}function g(){var e=App.GameInfo.correctAnswer[App.GameStat.currentIndex][0],t=App.GameInfo.correctAnswer[App.GameStat.currentIndex][1];$("#submit_choice").unbind("click");$("#next_question").unbind("click").fadeOut(300);App.AjaxCalls.apiQuestion(e,function(){App.GameStat.currentIndex++;if(App.GameStat.currentIndex===1){v();d();h()}else{$("#game #answers_wrapper ul li").remove()}$("#question_wrapper .question").html(App.GameStat.question);$.each(App.GameStat.choices,function(e,t){if(t==""){return false}else{$("#game #answers_wrapper ul").append('<li><div class="icon" /><div class="txt">'+t+"</div></li>");$("#game #answers_wrapper ul li").hide()}});$("#game #answers_wrapper ul li").length?w(t):null;$("#game #answers_wrapper ul li").each(function(e){var t=Math.floor($(this).height());var n=Math.floor((t-20)/2);$(this).children("div").eq(0).css({"margin-top":n+"px","margin-bottom":n+"px"})})});return true}function y(){var e=App.GameInfo.correctAnswer[0,36][0],t=App.GameInfo.correctAnswer[0,36][1];App.AjaxCalls.apiQuestion(e,function(){$("#question_wrapper .question").html(App.GameStat.question);$.each(App.GameStat.choices,function(e,t){if(t==""){return false}else{$("#doubledown #answers_wrapper ul").append('<li><div class="icon" /><div class="txt">'+t+"</div></li>");$("#doubledown #answers_wrapper ul li").hide()}});$("#doubledown #answers_wrapper ul li").fadeIn(800);$("#doubledown #answers_wrapper li").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")}).bind("click",function(){$("#doubledown #answers_wrapper li").removeClass("selected");$(this).addClass("selected")});$("#submit_dd_choice").bind("click",function(){var e=$("#doubledown #answers_wrapper li.selected").index();if($("#doubledown #answers_wrapper li.selected").length<1){var n="please select an answer";Function.triggeralertbox(n)}else{$("#doubledown #answers_wrapper li").addClass("wrong_choice").delay(200).animate({color:jQuery.Color("#bd727b")},500);$("#doubledown #answers_wrapper .wrong_choice").eq(t).addClass("correct_choice").removeClass("wrong_choice");if(t==e){$("#submit_choice").fadeOut(600);$("#response_correct").fadeIn(800);App.GameStat.ddcorrect=2;setTimeout(function(){f("register")},2e3)}else{$("#submit_choice").fadeOut(600);$("#response_incorrect").fadeIn(800);App.GameStat.ddcorrect=3;setTimeout(function(){f("defeated")},2e3)}}})})}function b(){var e=[],t=0,n=[],r=[];$(".mCSB_container").children("div").each(function(n){if($(this).hasClass("checked")){e[t]=$(this).attr("id");t++}});if(e.length>6||e.length<6){var i="Please make sure you pick six partners in total.";Function.triggeralertbox(i)}else{t=0;while(t<e.length){var s=false;var o=p(0,5);for(var u=0;u<r.length;u++){if(o==r[u]){s=true;break}}if(!s){r[t]=o;t++}}for(var a=0;a<r.length;a++){n[a]=e[r[a]]}App.Partners.picked=n;App.AjaxCalls.apiGame(n,function(){f("game")})}}function w(e){$("#answers_wrapper ul li").fadeIn(800);$("#answers_wrapper li").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")}).bind("click",function(){$("#answers_wrapper li").removeClass("selected");$(this).addClass("selected")});$("#submit_choice").fadeIn(500);$("#submit_choice").bind("click",function(){var t=$("#answers_wrapper li.selected").index();if($("#answers_wrapper li.selected").length<1){var n="please select an answer";Function.triggeralertbox(n)}else{$("#answers_wrapper li").addClass("wrong_choice").delay(200).animate({color:jQuery.Color("#bd727b")},500);$("#answers_wrapper li").eq(e).addClass("correct_choice").removeClass("wrong_choice");if(e==t){App.GameStat.correctAnswered++;$("#submit_choice").fadeOut(400,function(){$(".game_row .open").animate({color:"#bd727b"},400);var e=setInterval(function(){E()},100);setTimeout(function(){clearInterval(e)},2400);setTimeout(function(){S(App.GameStat.correctAnswered)},2600)})}else{App.GameStat.incorrectAnswered++;$("#submit_choice").fadeOut(400,function(){$(".game_row .open").animate({color:"#bd727b"},400);var e=setInterval(function(){E()},100);setTimeout(function(){clearInterval(e)},2400);setTimeout(function(){x(App.GameStat.incorrectAnswered)},2600)})}}})}function E(){$("#game_board").each(function(){var e=$(this).find(".open");var t=e.length;var n=e.eq(Math.floor(t*Math.random()));n.animate({color:jQuery.Color("#fff")},100,function(){$(this).animate({color:jQuery.Color("#bd727b")},100)})})}function S(e){var t=App.GameStat.winningSeq[e-1];$("#cell"+t).removeClass("open").stop(true,true).animate({color:jQuery.Color("#fff")},50,function(){var e=0;var n=setInterval(function(){e+=1;if(e===6){clearInterval(n)}$("#cell"+t).animate({color:jQuery.Color("#bd727b")},100,function(){$(this).animate({color:jQuery.Color("#fff")},100)})},100);$(this).addClass("correct").append('<div class="correct_badge"><img src="/common/img/icon/bingo_dot.png" alt="" /></div>').children("span").delay(1200).fadeOut(800);$(this).children("div").hide().delay(1400).fadeIn(1e3);if(App.GameStat.correctAnswered==App.GameStat.winningSeq.length){App.GameStat.ddcorrect=1;if(App.GameStat.played===1){setTimeout(function(){f("confirm")},2e3)}else{setTimeout(function(){f("success")},2e3)}}else{T()}})}function x(e){var t=App.GameStat.losingSeq[e-1];$("#cell"+t).addClass("incorrect");$("#cell"+t).removeClass("open").stop(true,true).animate({color:jQuery.Color("#fff")},50,function(){var e=0;var n=setInterval(function(){e+=1;if(e===6){clearInterval(n)}$("#cell"+t).animate({color:jQuery.Color("#bd727b")},100,function(){$(this).animate({color:jQuery.Color("#fff")},100)})},100);$(this).addClass("incorrect").children("span").delay(1300).fadeOut(700,"easeInQuad");setTimeout(function(){$(".incorrect span").rotate({animateTo:720})},1600);if(App.GameStat.incorrectAnswered>App.GameStat.losingSeq.length-1){App.GameStat.ddcorrect=0;setTimeout(function(){f("defeated")},2e3)}else{T()}})}function T(){$("#next_question").delay(2300).fadeIn(500).bind("click",function(){$(this).hide();g();$("#game #answers_wrapper ul li").fadeOut(800,function(){$(".game_row .open").animate({color:"#fff"},500)})})}function N(e){if(App.GameStat.played===0){if(App.GameStat.ddcorrect===0){}else if(App.GameStat.ddcorrect===1){$(".awarded_offer").append('<h1>You\'ve Won:</h1><div class="partner_offer"><img src="/images/logos/'+App.Partners.singleId+'.jpg" alt="'+App.Partners.singleTitle+'" /></div><div id="partner_offer_desc">'+App.Partners.singleOffers.offer_small+"</div>")}else if(App.GameStat.ddcorrect===2){if(e==="confirm"){$(".confirmpg").prepend("<h2>Here's your offer:</h2>")}$(".awarded_offer").append('<h1>You\'ve Won:</h1><div class="partner_offer"><img src="/images/logos/'+App.Partners.singleId+'.jpg" alt="'+App.Partners.singleTitle+'" /></div><div id="partner_offer_desc">'+App.Partners.singleOffers.offer_large+"</div>")}else{}}}function C(e){if(e.length!=11){return false}var t=0;var n;var r;for(var i=0;i<10;i++){switch(i){case 0:n=6;break;case 1:n=5;break;case 2:n=4;break;case 3:n=3;break;case 4:n=8;break;case 5:n=7;break;case 6:n=6;break;case 7:n=5;break;case 8:n=4;break;case 9:n=3;break}t+=e[i]*n}var s=t%11;if(s<2){r="0"}else{r=11-s}if(r==e[10]){return true}else{return false}}function k(){$("#registerBtn").unbind("click");$(".mainInputs > input").focus(function(){var e=$(this).val();if(e==="First Name"||e==="Last Name"||e==="Email"||e==="Elevate #"){$(this).attr("title",e).val("")}});$(".mainInputs > input").blur(function(){var e=$(this).val();if(e===""){$(this).val($(this).attr("title"))}});$("#dailyPrize, #epicPrize").bind("click",function(){if($(this).attr("name")==="false"){$(this).attr("name","true").css({backgroundPosition:-22+"px "+0+"px"})}else{$(this).attr("name","false").css({backgroundPosition:0+"px "+0+"px"})}});$("#registerBtn").bind("click",function(){var e=null,t=null,n=null,r=null,i=null,s=1,o=1,u="<ul style='padding-left: 85px; width:65%;'><b>Please correct the following errors:</b> <br>",a={msg1:"",msg2:"",msg3:"",msg4:""},l=0;$Rfirstname=$("input[name='firstName']").val(),$Rlastname=$("input[name='lastName']").val(),$Remail=$("input[name='email']").val(),$RelId=$("input[name='elevate']").val();if($("#dailyPrize").attr("name")==="true"){s=1}else{s=""}if($("#epicPrize").attr("name")==="true"){o=1}else{o=""}if($Rfirstname===""||$Rfirstname==="First Name"){$("input[name='firstName']").css({border:"1px solid red"});e="";a.msg1="<li>Fill out first name</li>";l++}else{$("input[name='firstName']").css({border:"1px solid #FFF"});e=$Rfirstname;a.msg1="";l-1}if($Rlastname===""||$Rlastname==="Last Name"){$("input[name='lastName']").css({border:"1px solid red"});t="";a.msg2="<li>Fill out last name</li>";l++}else{$("input[name='lastName']").css({border:"1px solid #FFF"});t=$Rlastname;a.msg2="";l-1}var c=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(!c.test($Remail)){$("input[name='email']").css({border:"1px solid red"});n="";a.msg3="<li>Enter a valid email</li>";l++}else{$("input[name='email']").css({border:"1px solid #FFF"});n=$Remail;a.msg3="";l-1}if($RelId===""||$RelId==="Elevate #"){$("input[name='elevate']").css({border:"1px solid red"});r="";a.msg4="<li>Enter a valid Elevate number</li>";l++}else{if(C($RelId)){$("input[name='elevate']").css({border:"1px solid #FFF"});r=$RelId;a.msg4="";l-1}else{$("input[name='elevate']").css({border:"1px solid red"});r="";a.msg4="<li>Enter a valid Elevate number</li>";l++}}if(l>0){for(key in a){if(a[key]!==""){u+=a[key]}}Function.triggeralertbox(u+="</ul>")}else{if(App.GameStat.ddcorrect===0){i=null}else if(App.GameStat.ddcorrect===1){i=App.Partners.singleId+"-S"}else if(App.GameStat.ddcorrect===2){i=App.Partners.singleId+"-L"}else{i=null}App.AjaxCalls.apiRegister(n,e,t,r,i,s,o);$("#gifload").fadeOut(200,function(){$("#registerBtn").delay(1e3).fadeIn(200)});if(App.GameStat.ddcorrect===1||App.GameStat.ddcorrect===2){$.cookie("played",true,{expires:1})}f("confirm")}})}function L(){if(App.GameStat.ddcorrect===0){$(".defeatedCopy").html("Though you didn't get six in a row, you can always play again or register and enter for the chance to win the daily prize. Check out our <a target='_blank' href='http://www.virginamerica.com/frequent-flyer/elevate-partners.html'>Elevate partners</a> to see the kinds of rewards you'll be in the running for.")}if(App.GameStat.ddcorrect===3){$(".defeatedCopy").html("Though you didn't get the Double Down question correct, you can always play again or register and enter for the chance to win the daily prize.")}}function A(){var e;if(App.GameStat.ddcorrect===0){e="I just played Go Big Bingo for the chance to win epic prizes from Virgin America and their top Elevate partners. Get your chance to win here: http://bit.ly/gobigbingo"}else if(App.GameStat.ddcorrect===1){e="I just played Go Big Bingo and won "+App.Partners.singleOffers.offer_small+" through "+App.Partners.singleTitle+". Get your chance to win here: http://bit.ly/gobigbingo"}else if(App.GameStat.ddcorrect===2){e="I just played Go Big Bingo and won "+App.Partners.singleOffers.offer_large+" through "+App.Partners.singleTitle+". Get your chance to win here: http://bit.ly/gobigbingo"}else{e="I just played Go Big Bingo for the chance to win epic prizes from Virgin America and their top Elevate partners. Get your chance to win here: http://bit.ly/gobigbingo"}$("a.js-facebook").attr("data-socialpost",e)}function O(){$("div").unbind();var e=$.cookie("played");if(e==="true"){App.GameStat.played=1;$(".entertowin").fadeOut(0)}else{App.GameStat.played=0}if(App.GameStat.played===1){$(".entertowin").fadeOut(0)}var t=App.GameStat.played;for(key in App.GameStat){var n=null;if(typeof key==="number"){App.GameStat[key]=0}else{App.GameStat[key]=[]}}for(key in App.GameInfo){App.GameInfo[key]=[]}App.GameStat.currentIndex=0;App.GameStat.incorrectAnswered=0;App.GameStat.correctAnswered=0;App.GameStat.ddcorrect=0;App.GameStat.played=t;App.Partners.picked=[];App.Partners.singleOffers=null;App.Partners.singleId=0;App.Partners.singleTitle="";App.Partners.all=[];$("#game_logo > a").fadeOut(300);$("#landing").fadeIn(300,function(){$("#pick_partners, #game, #defeated, #success, #register, #confirm").fadeOut(300,function(){$(this).html("")});D();App.Page.current="landing";App.Page.prev="landing";App.AjaxCalls.apiPartners()})}function M(){var e=new Date,t=String(e.getDate()),n=String(e.getMonth()+1);$(".dailyPrize").html('<img src="/common/img/daily/'+n+"_"+t+'.png" alt="" />')}function _(){if(e.width()/e.height()<s){r.removeClass().addClass("bgheight")}else{r.removeClass().addClass("bgwidth")}}function D(){$(".btn_continue").bind("click",function(){var e=$(this).attr("name");f(e);return false});$(".entertowin, #sorryRegister").bind("click",function(){f("register");return false});$("#selectSix").bind("click",function(){b();return false});$("#double_down").bind("click",function(){f("doubledown");return false});$("#keep_offer").bind("click",function(){f("register");return false});$(".reset").bind("click",function(){O();return false})}function P(){this.init=function(){$(".js-facebook").unbind("click");$(".js-twitter").unbind("click");$(".js-facebook").on({click:this.facebook});$(".js-twitter").on({click:this.twitter})};this.facebook=function(){var e=encodeURIComponent("http://gobigbingo.virginamerica.com/"),t=encodeURIComponent($(this).attr("data-socialtitle")),n=encodeURIComponent($(this).attr("data-socialpost")),r=encodeURIComponent($(this).attr("data-socialimage"));window.open("http://facebook.com/sharer/sharer.php?s=100&p[url]="+e+"&p[title]="+t+"&p[images][0]="+r+"&p[summary]="+n,+"_blank","width=600, height=260")};this.twitter=function(){var e=encodeURIComponent("http://bit.ly/gobigbingo"),t=encodeURIComponent($(this).attr("data-socialtitle")),n=encodeURIComponent($(this).attr("data-socialpost")),r=encodeURIComponent($(this).attr("data-socialimage"));window.open("https://twitter.com/intent/tweet?text="+n+"&url="+e,"_blank","width=600,height=400")}}var e=$(window),t=$(document),n=$("#master"),r=$("#bkgnd"),s=r.width()/r.height();window.App={};App.GameStat={ddcorrect:0,correctAnswered:0,played:0,incorrectAnswered:0,question:[],choices:[],currentIndex:0,winningSeq:[],losingSeq:[],boardNums:[]};App.GameInfo={cells:[],correctCells:[],correctAnswer:[]},App.Partners={picked:[],singleOffers:null,singleId:0,singleTitle:"",all:[]};App.Page={prev:"",current:"",next:"",pages:["landing","pick_partners","game","defeated","success","register","doubledown","confirm"]};App.LoadPage={init:function(e,t){$("#game_logo > a").fadeIn(200);$("#"+App.Page.current).fadeOut(300,function(){$("#"+e).load(e+".php",function(){$("#"+e).fadeIn(700);D();t()});App.Page.prev=App.Page.current;App.Page.current=e})},welcome:function(){$("#game_logo > a").fadeOut(0);$("#landing").load("landing.php",function(){var e=$.cookie("played");if(e==="true"){App.GameStat.played=1;$(".entertowin").fadeOut(0)}else{App.GameStat.played=0}$(this).fadeIn(300);D();M()});App.Page.current="landing";App.Page.prev="landing"}};App.AjaxCalls={apiData:"",apiPartners:function(){$.ajax({type:"POST",url:"/api/",data:{option:"partners"},cache:false,async:false,success:function(e,t,n){App.Partners.all=e}})},apiPartner:function(e){$.ajax({type:"POST",url:"/api/",data:{option:"partner",partner_id:e},cache:false,async:false,success:function(e,t,n){App.Partners.singleOffers=e}})},apiGame:function(e,t){$.ajax({type:"POST",url:"/api/",data:{option:"game",partners:e},cache:false,success:function(e,n,r){App.GameInfo.cells=e[0];App.GameInfo.correctAnswer=e[1];t()}})},apiQuestion:function(e,t){$.ajax({type:"POST",url:"/api/",data:{option:"question",qid:e},cache:false,success:function(e,n,r){App.GameStat.question=e["q"];App.GameStat.choices=e["a"];returntype=n;t()}})},apiRegister:function(e,t,n,r,i,s,o){var u={option:"register",first_name:t,last_name:n,email:e,eid:r,enter_daily_prize:s,enter_epic_prize:o};if(i!==null){u["prize"]=i}$.ajax({type:"POST",url:"/api/",data:u,cache:false,success:function(e,t,n){},complete:function(e,t){}})}};App.LoadPage.welcome();u();App.AjaxCalls.apiPartners();o();e.resize(_).trigger("resize");})